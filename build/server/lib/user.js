// Generated by CoffeeScript 1.10.0
var config, path, spawn;

spawn = require('child_process').spawn;

config = require('./conf').get;

path = require('path');


/*
    Create user cozy-<app>
        Use script adduser.sh
 */

module.exports.create = function(app, callback) {
  var child, env, script;
  if (!app.user.match(/^cozy-\w+$/)) {
    callback(new Error('Invalid username'));
    return;
  }
  env = {};
  env.USER = app.user;
  env.HOME = config('dir_app_bin');
  env.SHELL = process.env.SHELL;
  env.PATH = process.env.PATH;
  script = path.join(__dirname, '..', 'lib', 'adduser.sh');
  child = spawn('sh', [script], {
    env: env
  });
  return child.on('exit', function(code) {
    if (code === 0) {
      return callback();
    } else {
      return callback(new Error('Unable to create user'));
    }
  });
};


/*
    Remove appplication user
 */

module.exports.remove = function(app, callback) {
  return callback();
};
