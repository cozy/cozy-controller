// Generated by CoffeeScript 1.8.0
var config, fs, path;

path = require("path");

config = require('./conf').get;

fs = require('fs');


/*
    Usefull to translate application stored in database in manifest
 */

exports.App = (function() {
  function App(app) {
    var homeDir, logDir, manifest, match, start, _ref, _ref1;
    this.app = app;
    homeDir = config('dir_source');
    logDir = config('dir_log');
    this.app.dir = path.join(homeDir, this.app.name);
    this.app.user = 'cozy-' + this.app.name;
    match = this.app.repository.url.match(/\/([\w\-_\.]+)\.git$/);
    this.app.logFile = path.join(logDir, "/" + app.name + ".log");
    if (((_ref = this.app.scripts) != null ? _ref.start : void 0) != null) {
      this.app.server = this.app.scripts.start;
    } else {
      manifest = require(path.join(this.app.dir, "package.json"));
      if (((_ref1 = manifest.scripts) != null ? _ref1.start : void 0) != null) {
        start = manifest.scripts.start.split(' ');
        this.app.server = start[start.length - 1];
      } else if (fs.existsSync(path.join(this.app.dir, 'build', 'server.js'))) {
        this.app.server = 'build/server.js';
      } else {
        this.app.server = 'server.coffee';
      }
    }
    this.app.startScript = path.join(this.app.dir, this.app.server);
  }

  return App;

})();
