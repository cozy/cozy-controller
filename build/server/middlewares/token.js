// Generated by CoffeeScript 1.8.0
var token;

token = "";


/*
    Initalise token in RAM
 */

module.exports.init = (function(_this) {
  return function(current_token) {
    return token = current_token;
  };
})(this);


/*
    Check if request in authenticated :
        * Return 401 as error code if request hasn't a token
        * return 403 as error code if token is bad
        * Continue if token is correct
 */

module.exports.check = (function(_this) {
  return function(req, res, next) {
    var auth;
    if (process.env.NODE_ENV === "production" || process.env.NODE_ENV === "test") {
      auth = req.headers['x-auth-token'];
      if (auth !== "undefined" && (auth != null)) {
        if (auth !== token) {
          return res.send(401, "Token is not correct");
        } else {
          return next();
        }
      } else {
        return res.send(401, "Application is not authenticated");
      }
    } else {
      return next();
    }
  };
})(this);


/*
    Return token 
        Usefull in spawner to transmit token to stack application
 */

module.exports.get = (function(_this) {
  return function() {
    return token;
  };
})(this);
